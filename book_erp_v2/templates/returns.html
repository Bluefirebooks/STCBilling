{% extends "base.html" %}
{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <h4 class="fw-bold mb-0">Returns</h4>
  <span class="text-muted small">Party return â†’ Stock back to warehouse</span>
</div>

<div class="card p-4 mb-3">
  <h6 class="fw-bold">Create Return Note</h6>
  <form method="post" action="/returns/create" class="row g-2">
    <div class="col-md-5">
      <label class="form-label small text-muted">Party</label>
      <select class="form-select" name="party_id">
        {% for p in parties %}<option value="{{p.id}}">{{p.name}}</option>{% endfor %}
      </select>
    </div>
    <div class="col-md-4">
      <label class="form-label small text-muted">Warehouse</label>
      <select class="form-select" name="warehouse_id">
        {% for w in whs %}<option value="{{w.id}}">{{w.name}}</option>{% endfor %}
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label small text-muted">Return Date</label>
      <input class="form-control" name="return_date" type="date">
    </div>

    <div class="col-md-6"><input class="form-control" name="reason" placeholder="Reason (Unsold/Damaged/etc)"></div>
    <div class="col-md-6"><input class="form-control" name="notes" placeholder="Notes"></div>
    <div class="col-12"><button class="btn btn-dark">Create</button></div>
  </form>
</div>

{% if rn %}
<div class="card p-4 mb-3">
  <div class="d-flex justify-content-between flex-wrap gap-2">
    <div>
      <div class="fw-bold">{{ rn.rn_no }}</div>
      <div class="text-muted small">Date: {{ rn.return_date }} | Status: <span class="badge text-bg-secondary">{{ rn.status }}</span></div>
    </div>
    <a class="btn btn-outline-dark" href="/returns">Back</a>
  </div>
</div>

<div class="card p-4 mb-3">
  <h6 class="fw-bold">Add Return Line</h6>
  <form method="post" action="/returns/{{rn.id}}/add-line" class="row g-2">
    <div class="col-md-9">
      <select class="form-select" name="item_id">
        {% for it in items %}
          <option value="{{it.id}}">{{it.sku}} - {{it.title}}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-2"><input class="form-control" name="qty" type="number" placeholder="Qty" required></div>
    <div class="col-md-1"><button class="btn btn-dark w-100">Add</button></div>
  </form>
</div>

<div class="card p-3 mb-3">
  <div class="table-responsive">
    <table class="table table-sm align-middle mb-0">
      <thead class="table-light"><tr><th>Item</th><th>Qty</th></tr></thead>
      <tbody>
        {% for l in lines %}
        <tr><td>{{l.item_id}}</td><td>{{l.qty}}</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<form method="post" action="/returns/{{rn.id}}/post">
  <button class="btn btn-dark">POST Return (Stock Add Back)</button>
</form>

{% else %}

<div class="card p-3">
  <div class="table-responsive">
    <table class="table table-sm align-middle mb-0">
      <thead class="table-light"><tr><th>RN No</th><th>Date</th><th>Party</th><th>Status</th><th>Open</th></tr></thead>
      <tbody>
      {% for r in rns %}
        <tr>
          <td class="fw-semibold">{{r.rn_no}}</td>
          <td>{{r.return_date}}</td>
          <td>{{r.party_id}}</td>
          <td><span class="badge text-bg-secondary">{{r.status}}</span></td>
          <td><a class="btn btn-sm btn-outline-dark" href="/returns/{{r.id}}">Open</a></td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endif %}
{% endblock %}