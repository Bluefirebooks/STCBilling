{% extends "base.html" %}
{% block content %}
<div class="card p-4">
  <h5 class="fw-bold">Barcode Scan</h5>
  <p class="text-muted">Phone camera se SKU/Barcode scan karke result copy kar sakte ho.</p>

  <div class="row g-3">
    <div class="col-md-7">
      <video id="video" class="w-100 border rounded" style="max-height:420px" autoplay></video>
    </div>
    <div class="col-md-5">
      <label class="form-label">Scanned Result</label>
      <input class="form-control" id="result" placeholder="Scan will appear here">
      <div class="mt-3 d-flex gap-2">
        <button class="btn btn-dark" onclick="startScan()">Start</button>
        <button class="btn btn-outline-secondary" onclick="stopScan()">Stop</button>
      </div>
    </div>
  </div>
</div>

<script src="https://unpkg.com/@zxing/library@latest"></script>
<script>
let codeReader;

async function startScan(){
  const video = document.getElementById('video');
  const result = document.getElementById('result');
  codeReader = new ZXing.BrowserMultiFormatReader();
  const devices = await ZXing.BrowserCodeReader.listVideoInputDevices();
  const deviceId = devices[0]?.deviceId;
  await codeReader.decodeFromVideoDevice(deviceId, video, (res, err) => {
    if(res){ result.value = res.getText(); }
  });
}
function stopScan(){ if(codeReader){ codeReader.reset(); } }
</script>
{% endblock %}